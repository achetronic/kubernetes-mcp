# MCP Server Configuration
server:
  name: "Kubernetes MCP"
  version: "0.1.0"
  transport:
    type: "http"
    http:
      host: ":8080"

# Middleware Configuration
middleware:
  access_logs:
    excluded_headers:
      - X-Excluded
    redacted_headers:
      - Authorization
      - X-Validated-Jwt

  jwt:
    enabled: true
    validation:
      strategy: "external"  # Values: 'local' or 'external'
      forwarded_header: "X-Validated-Jwt"
      local:
        jwks_uri: &JwksUri "https://keycloak.example.com/realms/mcp-servers/protocol/openid-connect/certs"
        cache_interval: "10s"
        allow_conditions: []

# Oauth Authorization Server Configuration
oauth_authorization_server:
  enabled: true
  issuer_uri: "https://keycloak.example.com/realms/mcp-servers"

# OAuth Protected Resource Configuration
oauth_protected_resource:
  enabled: true
  resource: "https://kubernetes-mcp.example.com/mcp"
  auth_servers:
    - "https://keycloak.example.com/realms/mcp-servers"
  jwks_uri: *JwksUri
  scopes_supported:
    - openid
    - profile
    - email
    - groups
    - kubernetes-mcp/custom-audience
  bearer_methods_supported: []
  resource_signing_alg_values_supported: []
  resource_name: ""
  resource_documentation: ""
  resource_policy_uri: ""
  resource_tos_uri: ""
  tls_client_certificate_bound_access_tokens: false
  authorization_details_types_supported: []
  dpop_signing_alg_values_supported: []
  dpop_bound_access_tokens_required: false

# Kubernetes Configuration
kubernetes:
  default_context: "default"
  contexts:
    - name: "default"
      kubeconfig: ""  # Uses ~/.kube/config
      description: "Default Kubernetes cluster"
      allowed_namespaces: []
      denied_namespaces:
        - kube-system
        - kube-public

  # Auto-load kubeconfigs from directory (context name = current-context of each file)
  # contexts_dir: "/shared/kubeconfigs/"

  tools:
    bulk_operations:
      max_resources_per_operation: 100

# Authorization Configuration
authorization:
  allow_anonymous: false
  identity_claim: "email"
  policies:
    # Allow all for authenticated users (basic policy)
    - name: "authenticated-users"
      description: "Allow all tools for authenticated users"
      match:
        expression: 'has(payload.sub)'
      allow:
        tools: ["*"]
        contexts: ["*"]
        resources:
          # All real K8s resources
          - groups: ["*"]
            kinds: ["*"]
          # All virtual MCP resources (discovery, context, cluster info)
          - groups: ["_"]
            kinds: ["*"]
